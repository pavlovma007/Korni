a-proof-of-correctness-for-caspaxos.md 



Justin Jaffray

[blog](https://justinjaffray.com/posts)[notes](https://justinjaffray.com/notes)

Заметки в блоге Джастина Джеффри

# Доказательство правильности для CASPaxos

10 апреля 2018
Этот пост был написан в соавторстве с Ильей Щербаковым.

[CASPaxos](https://arxiv.org/pdf/1802.07000.pdf) - это недавний и интересный алгоритм консенсуса, изобретенный [Денисом Рысцовым](https://twitter.com/rystsov)

Документ, описывающий CASPaxos, предоставляет доказательство правильности в своем приложении, здесь представлено альтернативное доказательство.

Во-первых, давайте рассмотрим протокол. Есть несколько участников.

## Клиенты

Клиент отправляет функцию преобразования заявителю.

Предлагающий может ответить сообщением об успешном завершении, состоящим из выходных данных функции, примененной к предыдущему значению регистра, вместе с утверждением, что возвращенное значение было помещено в регистр.

В качестве альтернативы клиент может не получить ответа, что означает неопределенность результата.

## Претенденты

Претенденты получают сообщения от клиентов. Когда предлагающий получает запрос, содержащий функцию преобразования *f* от клиента, это:

- Генерирует новый номер "бюллетеня" b для голосования. 
  b отличается от любого другого номера избирательного бюллетеня. Номера бюллетеней - это натуральные числа, которые уникальны для всех копий. Метод, с помощью которого генерируются уникальные номера бюллетеней, остается неопределенным.
- Отправляет PREPARE сообщение каждому из 2F+1 узлов (акцепторов),
- Ожидает F+1 ответ PREPARE OK от акцепторов , каждое из низ содержит
  - очередное значение v[i]
  - номер бюлетеня для этого значения b[i]
- определяет новое значение применяя функцию f к v[j] , где j=i - для максимального b[i] для каждого из 2F+1 акцепторов (у нас же только F+1 ответов. ничего?)
- отправляет акцепторам ACCEPT , содержащее v[new] , max(b[i]) rf;ljve 2F+1  акцептору
- ожидает F+1 ответов
- отправить ответ клиенту с v[new]

## Акцепторы

> Вся логика тут и значения для конкретного отдельного *распроеделенного регистра* (примечание переводчика)

Акцепторы принимают сообщения от Претендентов\Предлагателей . Акцептор хранит три части состояния *распределенного регистра*:

- Текущее значение  *value* (инициалируется в специальное значение ∅∅),
- текущий номер бюлетеня  *ballot* (инициализируется в  0),  и 
- текущее обещание  *promise* (тоже инициализируется 0).

Когда  акцептор принимает сообщение `PREPARE` от предлагателя\претендента  , содержащее номер бюлетеня ballot number *b*:

- если *b*  меньше номера обещания *ballot* or *promise*, ничего не делать.
- иначе,  установить обещание , обещать *promise* *b*  и ответить сообщением  `PREPARE OK` , содержащим его  *value* и номер бюлетеня *ballot*.

Когда акцептор получает  `ACCEPT` сообщение от предлагателя\претендента , содержащее номер бюлетеня ballot number *b* и значение value *v*:

- если *b*  меньше чем обещание бюлетеня  *ballot* or *promise*, ничего не делать.
- иначе , установить номер бюлетеня  *ballot* в  *b*, установить значение  *value* to *v*,  и ответить сообщением  `ACCEPT OK`.

## Correctness \ Корректность, доказательство

> не переводил, смотри далее  доказательство в оригинальной статье 
>
> https://justinjaffray.com/a-proof-of-correctness-for-caspaxos/

## Линеаризуемость

>  смотри доказательство там же 